# 获取应用宝app的评论数据
  在做数据分析之前，首先要做的定是获取数据，若没有一个良好的官方渠道获取数据，那么只能靠自己去网络爬取数据。最近在和工作室小伙伴们一起做的项目需要app的评论数据，最开始的时候是用python去实现，python在数据爬取方面确实方便简单，没有多少上手的难度，不过因为自身对python不太熟悉，难以对数据进行后续处理，所以有转回用Java实现了

## 爬数据的所需流程

	1、去想要爬取的网站找到相关的链接
	2、分析研究该链接，找到其传输方式、所需要的参数和响应后的数据
	3、代码实现及功能测试
	4、整理数据并储存

初步想了想爬取网页数据分析，只有这么几个步骤。接下来就是一步步实现了。

## 1、找到相关链接

我们本次的目标是要获取应用宝的评论数据，所以自然要去应用宝的网站去找相关链接。首先用谷歌浏览器（或其他具有相类似功能的浏览器）打开应用宝官网，接着随意进入一个应用，我们演示的是进入QQ。我们先右键查看源码，浏览源码记录中我们发现评论模块中没有评论展示的数据，也就是说腾讯在这里是做成了动态页面，并不是像豌豆荚一样把评论数据和应用信息做出静态页面。

![image](https://github.com/DarnellChen/note/blob/master/blog/img/getMyappComment/0.PNG)

故此我们返回到正式页面，按F12调出谷歌的控制台，如图所示：1、点击Network（网络），2、选择XHR。刷新一下页面后，我们发现3处多出了一条记录，我推测这条数据传输传递的内容就是评论数据。


![image](https://github.com/DarnellChen/note/blob/master/blog/img/getMyappComment/1.PHG)

### 
	（释义：XHR为向服务器发送请求和解析服务器响应提供了流畅的接口，能够以异步方式从服务器取得更多信息。意味在Network中监控的XHR信息是数据传输信息，故当我们猜测网页在某个的地方进行数据交互时，可以先查看XHR的监测信息）
	
现在我们需要验证我们的想法了,点击该记录，在新出现的区域中点击Response查看响应的信息内容，在这里面，我们看到了有相关评论的内容，到这就可以确定了这条记录就是我们要找的东西了。

![image](https://github.com/DarnellChen/note/blob/master/blog/img/getMyappComment/2.PHG)

## 2、分析

点击Headers，在这里我们可以看到请求的时候一般的General（基础信息）、Response Headers（响应头）、Request Headers（请求头）、Query String Parameters（参数）四个信息，在此因为腾讯的要求不是很严格，不需要伪造请求头，所以我们只需要关注基础信息和参数，两个部分。
在General中，我们可以看到Request URL （请求链接）的信息，http://sj.qq.com/myapp/app/comment.htm 就是我们要爬取的链接了；Request Method （请求方式）是post，意味着在代码实现时需要用post请求。

在参数信息中，我们看到有apkName（顾名思义是apk的名字了），apkCode（应该是腾讯内部该apk的代号）这两个参数信息应该是腾讯内部为确定本次请求要查询的是哪一个app而确定的；p这个参数应该是页码数；fresh英文直译是新鲜度，猜测是判断请求的有效时间的，不过有一次测试中过了1天左右，该参数值依旧有效；contextData英文直译是上下文数据，应该是后端数据库进行分页操作的依据之一吧。

![image](https://github.com/DarnellChen/note/blob/master/blog/img/getMyappComment/3.PHG)

接下来我们回到Response，查看响应返回的数据，对数据进行分析。下面是一条返回信息，删掉了评论内容，隐藏了用户昵称。

### 案例模型
	{"total":null,"count":null,"obj":{"total":290843,"contextData":"id=1193817856666042368,t=1495202041","ret":0,"hasNext":1,"commentDetails":[{"content":"评论内容","pkgName":null,"versionCode":676,"uin":3479341137,"nickName":"***.","createdTime":1495027431,"score":5,"phoneMode":null,"phoneBrand":null}{"content":"评论内容","pkgName":null,"versionCode":676,"uin":3271144920,"nickName":"***","createdTime":1495203038,"score":1,"phoneMode":null,"phoneBrand":null},{"content":"不善言辞","pkgName":null,"versionCode":500,"uin":2774562501,"nickName":"***","createdTime":1495202041,"score":5,"phoneMode":null,"phoneBrand":null}]},"pageContext":null,"success":true,"pageSize":null,"msg":null}

我们可以轻而易举的发现这是一条json数据，而我们要的数据内容大多在“obj”这个键值储存的对象中。而“obj”中又有“total”、“contextData”参数之一以后肯定有用、“ret”、“hasNext”应该是判断后面是否还有数据、commentDetails评论详情这个就是我们要的数据需要重点分析，其对象格式为json数组，在代码实现的时候需要注意一下。

对commentDetails中的某一条数据进行分析可得：content 评论内容;pkgName 不太清楚是什么，不过该值均为null所以我们就先忽略吧;versionCode 版本号;createdTime 评论创建时间;score 评分;uin 用户唯一识别码（腾讯内部的？）;nickName 用户昵称;phoneMode 手机型号;phoneBrand 手机品牌;

有了链接、参数、返回数据，这几个信息就开始代码实现了。

明天更新代码实现部分


